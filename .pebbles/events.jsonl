{"type":"create","timestamp":"2026-02-18T23:41:42.503592Z","issue_id":"open-lcm-8a9","payload":{"description":"","priority":"1","title":"Rewrite OpenClaw core imports to dependency injection","type":"task"}}
{"type":"comment","timestamp":"2026-02-18T23:41:50.059857Z","issue_id":"open-lcm-8a9","payload":{"body":"## Task\n\nAll source files in src/ were copied from openclaw src/plugins/lcm/ and src/agents/tools/lcm-*.ts. They still have imports pointing to OpenClaw internals.\n\nRead specs/extraction-plan.md for the full import rewrite map.\nRead src/types.ts for the LcmDependencies interface.\n\n### Phase 1: Simple files — already clean\n- src/db/config.ts ✅\n- src/store/fts5-sanitize.ts ✅\n- src/store/index.ts ✅\n\n### Phase 2: Connection + migration\n- src/db/connection.ts — replace requireNodeSqlite with direct better-sqlite3 import\n- src/db/migration.ts — fix internal imports\n\n### Phase 3: Core engine files — thread LcmDependencies\nEach file that imports from OpenClaw core needs to accept LcmDependencies as a parameter and use injected deps instead of direct imports. Key files: summarize.ts, assembler.ts, compaction.ts, engine.ts, expansion*.ts, integrity.ts, large-files.ts, retrieval.ts\n\n### Phase 4: Tool files\n- Create src/tools/common.ts with local jsonResult, readStringParam, AnyAgentTool\n- Refactor each tool to factory function: createLcmGrepTool(deps) =\u003e AnyAgentTool\n- Replace context-engine imports with openclaw/plugin-sdk\n\n### Phase 5: Wire up index.ts\n- Construct LcmDependencies from OpenClawPluginApi\n- Register context engine and all tools\n\n### Phase 6: Fix test imports\n- Update test import paths, mock LcmDependencies\n\n### Constraints\n- Keep @mariozechner/pi-agent-core as peer dep for message types\n- ContextEngine interface from openclaw/plugin-sdk\n- Pure import/DI refactor — no business logic changes\n- Verify with npx tsc --noEmit"}}
{"type":"status_update","timestamp":"2026-02-18T23:44:08.406373Z","issue_id":"open-lcm-8a9","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-18T23:57:42.905438Z","issue_id":"open-lcm-8a9","payload":{}}
{"type":"create","timestamp":"2026-02-19T15:24:24.112281Z","issue_id":"open-lcm-6fc","payload":{"description":"Implement the full spec at specs/summary-presentation-and-depth-aware-prompts.md. Five phases: (1) schema migration for earliest_at, latest_at, descendant_count columns with backfill, (2) XML summary presentation format in assembler.ts replacing informal headers, (3) depth-dispatched summarization prompts (leaf, d1, d2, d3+) replacing single Pi-style template, (4) timestamp injection in compaction leafPass and condensedPass, (5) SummaryStore type/read/write updates.","priority":"1","title":"Depth-aware prompts, XML presentation, and schema additions","type":"task"}}
{"type":"status_update","timestamp":"2026-02-19T15:24:53.443082Z","issue_id":"open-lcm-6fc","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-19T15:32:41.583842Z","issue_id":"open-lcm-6fc","payload":{}}
{"type":"create","timestamp":"2026-02-20T14:10:05.458946Z","issue_id":"open-lcm-a52","payload":{"description":"","priority":"1","title":"Fix all 24 broken vitest tests","type":"task"}}
{"type":"comment","timestamp":"2026-02-20T14:10:12.211593Z","issue_id":"open-lcm-a52","payload":{"body":"All 24 test files fail on module resolution. Two categories:\n\n1. **Relative path mismatch**: Tests in test/ import from ./foo.js (e.g. ./assembler.js, ./engine.js, ./db/config.js) as if co-located with src/. Need vitest.config.ts with path aliases or rewrite imports to ../src/foo.js.\n\n2. **Stale monorepo imports**: Some tests still reference OpenClaw core internals:\n   - summarize.test.ts imports from ../../agents/model-auth.js, ../../agents/pi-embedded-runner/model.js, ../../providers/github-copilot-token.js\n   - lcm-tools.test.ts imports from ../../plugins/lcm/expansion-auth.js, ../../context-engine/init.js, ../../context-engine/registry.js\n   These need to be rewritten to use the plugin's own exports or properly mocked.\n\n**Fix plan:**\n1. Create vitest.config.ts with resolve.alias mapping or just fix all import paths\n2. Fix category 1: rewrite ./foo.js to ../src/foo.js in all test files\n3. Fix category 2: rewrite monorepo imports to use local plugin paths + proper mocks\n4. Ensure tsconfig includes test files (currently excludes **/*.test.ts)\n5. Run npx vitest run — all 24 suites should pass\n6. Do NOT change any business logic — import/config fixes only"}}
{"type":"status_update","timestamp":"2026-02-20T14:10:43.891971Z","issue_id":"open-lcm-a52","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T14:20:29.231118Z","issue_id":"open-lcm-a52","payload":{}}
{"type":"create","timestamp":"2026-02-20T15:40:05.959578Z","issue_id":"open-lcm-2b7","payload":{"description":"Review all uses of the name 'openclaw-lcm', 'open-lcm', '@martian-engineering/openclaw-lcm' across the entire repo and produce a comprehensive rename specification for changing the project name to 'lossless-claw' (npm: '@martian-engineering/lossless-claw' or similar).\n\nAudit should cover:\n- package.json (name, description, repository, homepage)\n- README.md (all references)\n- docs/*.md (all references)\n- Source code: any string literals, comments, log messages referencing the old name\n- Go module path in tui/go.mod\n- .goreleaser.yml (binary names, project name)\n- tui/Makefile\n- GitHub repo name implications (remote URLs, links in docs)\n- Import paths if package name changes\n- Any references in test files\n\nOutput: a checklist of every file and line that needs to change, with proposed new values. Do NOT make the changes — just document them.","priority":"2","title":"Audit and spec rename from openclaw-lcm to lossless-claw","type":"task"}}
{"type":"status_update","timestamp":"2026-02-20T15:40:38.518306Z","issue_id":"open-lcm-2b7","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T15:42:48.356723Z","issue_id":"open-lcm-2b7","payload":{}}
{"type":"create","timestamp":"2026-02-20T18:27:44.70641Z","issue_id":"lossless-claw-1c2","payload":{"description":"In the sessions list screen, display an estimate of the total tokens contained in each session JSONL file. Use the existing len/4 estimator. Helps users gauge raw content size before drilling in.","priority":"2","title":"TUI sessions view: show estimated total tokens per session file","type":"enhancement"}}
{"type":"status_update","timestamp":"2026-02-20T18:29:58.353543Z","issue_id":"lossless-claw-1c2","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T18:32:05.700988Z","issue_id":"lossless-claw-1c2","payload":{}}
{"type":"create","timestamp":"2026-02-20T19:36:50.034471Z","issue_id":"lossless-claw-f22","payload":{"description":"OpenClaw security scanner flags engine.ts as env-harvesting (false positive from process.env + 'post' in comment). Move all process.env reads out of engine.ts into LcmConfig/snapshotPluginEnv in index.ts. See specs/env-config-extraction.md for full plan.","priority":"2","title":"Extract env var reads from engine.ts into config module","type":"task"}}
{"type":"status_update","timestamp":"2026-02-20T19:37:27.306265Z","issue_id":"lossless-claw-f22","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-20T19:40:19.14537Z","issue_id":"lossless-claw-f22","payload":{}}
{"type":"close","timestamp":"2026-02-20T21:25:24.665336Z","issue_id":"lossless-claw-1c2","payload":{}}
{"type":"close","timestamp":"2026-02-20T21:25:27.916091Z","issue_id":"lossless-claw-f22","payload":{}}
{"type":"create","timestamp":"2026-02-21T00:36:04.443786Z","issue_id":"lossless-claw-77d","payload":{"description":"Implement specs/historical-session-backfill.md: new backfill command for importing pre-LCM session JSONL, iterative depth-aware compaction, optional single-root fold, optional transplant-to target conversation, tests + docs.","priority":"1","title":"Add lcm-tui historical session backfill command","type":"feature"}}
{"type":"status_update","timestamp":"2026-02-21T00:36:26.464901Z","issue_id":"lossless-claw-77d","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-21T00:47:02.401577Z","issue_id":"lossless-claw-77d","payload":{}}
{"type":"status_update","timestamp":"2026-02-21T04:18:08.898717Z","issue_id":"lossless-claw-77d","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-21T04:20:44.742609Z","issue_id":"lossless-claw-77d","payload":{}}
{"type":"create","timestamp":"2026-02-24T01:52:54.487434Z","issue_id":"lossless-claw-479","payload":{"description":"Implement the investigation/spec in specs/context-assembly-compaction-perf-overhead-spec.md. Scope includes low-overhead instrumentation, config flags, and benchmark methodology to quantify baseline vs LCM overhead on realistic turns.\n\nObjectives:\n1. Measure context assembly overhead per turn.\n2. Measure token estimation/serialization overhead per turn.\n3. Measure compaction decision/execution overhead per turn.\n4. Measure instrumentation tax (disabled vs sampled/full).\n\nDeliverables:\n1. Configurable perf instrumentation in LCM code paths.\n2. Structured perf outputs suitable for aggregation.\n3. Reproducible benchmark runbook and results summary.\n4. Docs updates for flags and interpretation.","priority":"1","title":"Measure per-turn LCM context assembly/compaction overhead","type":"epic"}}
{"type":"create","timestamp":"2026-02-24T01:52:54.5101Z","issue_id":"lossless-claw-354","payload":{"description":"Implement foundational perf tracing with near-zero disabled-path overhead.\n\nReference spec: specs/context-assembly-compaction-perf-overhead-spec.md\n\nAcceptance criteria:\n1. Add LCM perf env/config fields with sane defaults:\n   - LCM_PERF_ENABLED\n   - LCM_PERF_SAMPLE_RATE\n   - LCM_PERF_SLOW_TURN_MS\n   - LCM_PERF_LOG_LEVEL\n   - LCM_PERF_OUTPUT\n   - LCM_PERF_OUTPUT_PATH\n   - LCM_PERF_INCLUDE_DB_COUNTS\n   - LCM_PERF_INCLUDE_SERIALIZE_STATS\n   - LCM_PERF_REDACT_SESSION_ID\n2. Add a no-op tracer implementation and enabled tracer implementation with monotonic timers.\n3. Disabled mode incurs no meaningful allocations/work at call sites (guard-first API).\n4. Route perf emissions through LCM logger surface (not raw console logging for new perf events).\n5. Unit tests cover config parsing and tracer behavior.\n\nFile touch map:\n- src/db/config.ts\n- src/types.ts\n- index.ts\n- src/perf/perf-trace.ts (new)\n- test/* (config/tracer coverage)\n- docs/configuration.md\n- README.md","priority":"1","title":"Add low-overhead perf instrumentation scaffolding and config flags","type":"task"}}
{"type":"create","timestamp":"2026-02-24T01:52:54.534614Z","issue_id":"lossless-claw-dcb","payload":{"description":"Add per-turn and step-level instrumentation to assembly and token estimation paths.\n\nReference spec: specs/context-assembly-compaction-perf-overhead-spec.md\n\nAcceptance criteria:\n1. Emit per-turn summary metrics for assemble path (duration, counts, tokens).\n2. Emit sampled step metrics for:\n   - assemble.precheck\n   - assemble.fetch_context_items\n   - assemble.resolve_items\n   - assemble.resolve_message_item\n   - assemble.resolve_summary_item\n3. Capture token-estimation/serialization counters where enabled.\n4. Preserve existing behavior and return values of engine/assembler methods.\n5. Add tests validating metrics presence and sampling behavior.\n\nFile touch map:\n- src/engine.ts\n- src/assembler.ts\n- src/store/conversation-store.ts (only if lightweight counters need hook points)\n- src/store/summary-store.ts (only if lightweight counters need hook points)\n- test/engine.test.ts\n- test/*assembler* (add/update)","priority":"1","title":"Instrument assembly and token-estimation hotspots","type":"task"}}
{"type":"create","timestamp":"2026-02-24T01:52:54.558972Z","issue_id":"lossless-claw-5a2","payload":{"description":"Add step-level instrumentation for compaction loops and summarization normalization/retry paths.\n\nReference spec: specs/context-assembly-compaction-perf-overhead-spec.md\n\nAcceptance criteria:\n1. Emit compaction metrics for evaluate/leaf/sweep/condensed phases.\n2. Emit summarization call metrics separating:\n   - provider completion latency\n   - normalization/extraction latency\n   - retry/fallback path activation\n3. Include token before/after counters and compaction trigger metadata.\n4. Keep perf output sampled/thresholded according to config.\n5. Add tests validating emitted fields on normal and fallback summarization flows.\n\nFile touch map:\n- src/engine.ts\n- src/compaction.ts\n- src/summarize.ts\n- test/engine.test.ts\n- test/summarize.test.ts\n- test/*compaction* (add/update)","priority":"1","title":"Instrument compaction and summarization hotspots","type":"task"}}
{"type":"create","timestamp":"2026-02-24T01:52:54.581267Z","issue_id":"lossless-claw-0fd","payload":{"description":"Create benchmark workflow and produce overhead comparison artifacts.\n\nReference spec: specs/context-assembly-compaction-perf-overhead-spec.md\n\nAcceptance criteria:\n1. Define reproducible workload scenarios (short chat, coding/tool-heavy, long-running, file-heavy).\n2. Run matrix:\n   - A0 baseline legacy context engine\n   - A1 LCM perf disabled\n   - A2 LCM perf enabled sampled\n   - A3 LCM perf enabled full sample (controlled)\n3. Report p50/p90/p99 for turn, assembly, compaction, and instrumentation overhead deltas.\n4. Publish runbook + interpretation guide in docs.\n5. Provide recommendation thresholds for default sampling and slow-turn logging.\n\nFile touch map:\n- scripts/bench/turn-overhead.ts (new)\n- docs/perf/context-overhead-benchmark.md (new)\n- docs/configuration.md\n- README.md","priority":"1","title":"Run baseline-vs-LCM overhead experiments and publish runbook","type":"task"}}
{"type":"rename","timestamp":"2026-02-24T01:52:54.605196Z","issue_id":"lossless-claw-354","payload":{"new_id":"lossless-claw-479.1"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.605196Z","issue_id":"lossless-claw-479.1","payload":{"dep_type":"parent-child","depends_on":"lossless-claw-479"}}
{"type":"rename","timestamp":"2026-02-24T01:52:54.63016Z","issue_id":"lossless-claw-dcb","payload":{"new_id":"lossless-claw-479.2"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.63016Z","issue_id":"lossless-claw-479.2","payload":{"dep_type":"parent-child","depends_on":"lossless-claw-479"}}
{"type":"rename","timestamp":"2026-02-24T01:52:54.655572Z","issue_id":"lossless-claw-5a2","payload":{"new_id":"lossless-claw-479.3"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.655572Z","issue_id":"lossless-claw-479.3","payload":{"dep_type":"parent-child","depends_on":"lossless-claw-479"}}
{"type":"rename","timestamp":"2026-02-24T01:52:54.681559Z","issue_id":"lossless-claw-0fd","payload":{"new_id":"lossless-claw-479.4"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.681559Z","issue_id":"lossless-claw-479.4","payload":{"dep_type":"parent-child","depends_on":"lossless-claw-479"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.715099Z","issue_id":"lossless-claw-479","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.1"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.744566Z","issue_id":"lossless-claw-479","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.2"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.773813Z","issue_id":"lossless-claw-479","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.3"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.802447Z","issue_id":"lossless-claw-479","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.4"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.829645Z","issue_id":"lossless-claw-479.2","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.1"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.858587Z","issue_id":"lossless-claw-479.3","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.1"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.88699Z","issue_id":"lossless-claw-479.4","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.2"}}
{"type":"dep_add","timestamp":"2026-02-24T01:52:54.91873Z","issue_id":"lossless-claw-479.4","payload":{"dep_type":"blocks","depends_on":"lossless-claw-479.3"}}
{"type":"create","timestamp":"2026-02-24T23:16:22.461146Z","issue_id":"lossless-claw-569","payload":{"description":"Start with only fix #1 from perf plan: replace full conversation load with keyset/cursor-based windowed loading in TUI. Requirements: (1) initial open loads newest window only (configurable default window size), (2) reload preserves window behavior (no full history hydration), (3) explicit load-older/load-newer pagination commands or keybind path, (4) keyset pagination on stable cursor (message id), not OFFSET, (5) maintain current UX correctness for selection/focus after page transitions, (6) add instrumentation/timing logs around query duration and render latency, (7) add tests for paging boundaries and no-regression of ordering. Keep scope strictly to windowed loading; defer virtualization/lazy-body unless required by architecture.","priority":"1","title":"Implement windowed message loading in TUI conversation view","type":"task"}}
{"type":"status_update","timestamp":"2026-02-24T23:16:46.342867Z","issue_id":"lossless-claw-569","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-24T23:22:29.361118Z","issue_id":"lossless-claw-569","payload":{}}
{"type":"create","timestamp":"2026-02-26T22:46:33.099311Z","issue_id":"lossless-claw-bc1","payload":{"description":"Instead of requiring users to manually add LCM usage instructions to AGENTS.md/TOOLS.md, generate them dynamically in the assemble() method via the new systemPromptAddition field on AssembleResult.\n\nInstructions should include:\n- LCM recall priority (lcm_grep -\u003e lcm_describe -\u003e lcm_expand_query)\n- Expand-before-asserting guidance\n- Uncertainty checklist\n- Refusal-to-guess rule for exact claims from summaries\n- Context-aware: skip expand guidance when no summaries exist, emphasize it when heavily compacted\n- Version-coupled: instructions update with plugin code, no workspace file drift\n\nDepends on clawdbot-e98 (AssembleResult.systemPromptAddition field).","priority":"2","title":"Generate dynamic system prompt instructions from assemble()","type":"feature"}}
{"type":"comment","timestamp":"2026-02-26T22:46:40.401011Z","issue_id":"lossless-claw-bc1","payload":{"body":"Blocked by clawdbot-e98 (AssembleResult.systemPromptAddition field)"}}
{"type":"comment","timestamp":"2026-02-26T22:46:43.937447Z","issue_id":"lossless-claw-bc1","payload":{"body":"Depends on clawdbot-e98 (AssembleResult.systemPromptAddition field in OpenClaw context-engine)"}}
{"type":"status_update","timestamp":"2026-02-26T22:53:21.34072Z","issue_id":"lossless-claw-bc1","payload":{"status":"in_progress"}}
{"type":"status_update","timestamp":"2026-02-26T22:53:26.389687Z","issue_id":"lossless-claw-bc1","payload":{"status":"in_progress"}}
{"type":"close","timestamp":"2026-02-26T22:57:18.867227Z","issue_id":"lossless-claw-bc1","payload":{}}
